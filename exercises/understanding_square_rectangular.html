<!DOCTYPE html>
<html data-require="math math-format graphie graphie-helpers interactive">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>能由邊長和角的特性來認識正方形和長方形(3-s-07)</title>
    <script src="../khan-exercise.js"></script>
	<style type="text/css">
		#answer_area .sol input[type=text] {
			width: 30px;
		}
		#answer_area .entry input[type=text] {
			width: 30px;
		}
    </style>
	<script type="text/javascript">
		function ruler(center) {
			var graph = KhanUtil.currentGraph;
			this.set = graph.raphael.set();
			
			this.cx = center[0];
			this.cy = center[1];
			var lineColor = "#789";
			var pro = this;

			var r = 8.05;
			var imgPos = graph.scalePoint([this.cx - r, this.cy + r]);
			this.set.push(graph.mouselayer.image(Khan.urlBase + "images/ruler.png", imgPos[0], imgPos[1], 204, 208));


			// Customized polar coordinate thingie to make it easier to draw the double-headed arrow thing. 旋轉箭頭
			// angle is what you'd expect -- use that big protractor on your screen :)
			// pixels from edge is relative to the edge of the protractor; it's not the full radius
			var arrowHelper = function(angle, pixelsFromEdge) {
				var scaledRadius = graph.scaleVector(r);
				var scaledCenter = graph.scalePoint(center);
				var x = Math.sin((angle + 90) * Math.PI / 180) * (scaledRadius[0] + pixelsFromEdge) + scaledCenter[0];
				var y = Math.cos((angle + 90) * Math.PI / 180) * (scaledRadius[1] + pixelsFromEdge) + scaledCenter[1];
				return x + "," + y;
			};

			// Draw the double-headed arrow thing that shows users where to click and drag to rotate 旋轉箭頭
			var arrow = graph.raphael.path(
				" M" + arrowHelper(180, 6) +
				" L" + arrowHelper(180, 2) +
				" L" + arrowHelper(183, 10) +
				" L" + arrowHelper(180, 18) +
				" L" + arrowHelper(180, 14) +
				" A" + (graph.scaleVector(r)[0] + 10) + "," + (graph.scaleVector(r)[1] + 10) + ",0,0,1," + arrowHelper(170, 14) +
				" L" + arrowHelper(170, 18) +
				" L" + arrowHelper(167, 10) +
				" L" + arrowHelper(170, 2) +
				" L" + arrowHelper(170, 6) +
				" A" + (graph.scaleVector(r)[0] + 10) + "," + (graph.scaleVector(r)[1] + 10) + ",0,0,0," + arrowHelper(180, 6) +
				" Z"
			).attr({
				"stroke": null,
				"fill": KhanUtil.ORANGE
			});

			// add it to the set so it translates with everything else 旋轉箭頭
			this.set.push(arrow);

			this.centerPoint = KhanUtil.addMovablePoint({
				coord: center,
				visible: false
			});

			// Use a movablePoint for rotation 
			this.rotateHandle = KhanUtil.addMovablePoint({
				coord: [
					Math.sin(275 * Math.PI / 180) * (r + 0.5) + this.cx,
					Math.cos(275 * Math.PI / 180) * (r + 0.5) + this.cy
				],
				
				onMove: function(x, y) {
					var angle = Math.atan2(pro.centerPoint.coord[1] - y, pro.centerPoint.coord[0] - x) * 180 / Math.PI;
					pro.rotate(-angle - 5, true);
				}
			});

			// Add a constraint so the point moves in a circle
			this.rotateHandle.constraints.fixedDistance.dist = r + 0.5;
			this.rotateHandle.constraints.fixedDistance.point = this.centerPoint;

			// Remove the default dot added by the movablePoint since we have our double-arrow thing
			this.rotateHandle.visibleShape.remove();
			// Make the mouse target bigger to encompass the whole area around the double-arrow thing
			this.rotateHandle.mouseTarget.attr({ scale: 2.0 });

			// Make the arrow-thing grow and shrink with mouseover/out
			$(this.rotateHandle.mouseTarget[0]).bind("vmouseover", function(event) {
				arrow.animate({ scale: 1.5 }, 50);
			});
			$(this.rotateHandle.mouseTarget[0]).bind("vmouseout", function(event) {
				arrow.animate({ scale: 1.0 }, 50);
			});

			var setNodes = $.map(this.set, function(el) { return el.node; });
			this.makeTranslatable = function makeTranslatable() {
				$(setNodes).css("cursor", "move");
				$(setNodes).bind("vmousedown", function(event) {
					event.preventDefault();
					
					var startx = event.pageX - $(graph.raphael.canvas.parentNode).offset().left;
					var starty = event.pageY - $(graph.raphael.canvas.parentNode).offset().top;
					
					$(document).bind("vmousemove", function(event) {
						// mouse{X|Y} are in pixels relative to the SVG
						
						var mouseX = event.pageX - $(graph.raphael.canvas.parentNode).offset().left;
						var mouseY = event.pageY - $(graph.raphael.canvas.parentNode).offset().top;
						// can't go beyond 50 pixels from the edge
						mouseX = Math.max(35, Math.min(graph.xpixels - 35, mouseX));
						mouseY = Math.max(35, Math.min(graph.ypixels - 35, mouseY));
					
						var dx = mouseX - startx;
						var dy = mouseY - starty;
						
						$.each(pro.set.items, function() {
							this.translate(dx, dy);
						});
										
						pro.centerPoint.setCoord([pro.centerPoint.coord[0] + dx / graph.scale[0], pro.centerPoint.coord[1] - dy / graph.scale[1]]);
						pro.rotateHandle.setCoord([pro.rotateHandle.coord[0] + dx / graph.scale[0], pro.rotateHandle.coord[1] - dy / graph.scale[1]]);
						
						startx = mouseX;
						starty = mouseY;
					});

					$(document).one("vmouseup", function(event) {
						$(document).unbind("vmousemove");
					});
				});
			};

//圖形旋轉
			this.rotation = 0;

			this.rotate = function(offset, absolute) {
				var center = graph.scalePoint(this.centerPoint.coord);

				if (absolute) {
					this.rotation = 0;
				}

				this.set.rotate(this.rotation + offset, center[0], center[1]);
				this.rotation = this.rotation + offset;

				return this;
			};
			
			this.set.attr({ opacity: 0.8 });
			this.makeTranslatable();
			return this;
		}
	</script>
</head>
<body>
    <div class="exercise">
    <div class="problems">
		<div id="case1">
			<div class="vars">
				<var id="num">randRangeUnique(2,7,2)</var>
				<var id="b">num[0]</var>
				<var id="a">randRange(1,2)</var>				
				<var id="b1">(function(){
						if(a==1)
						{
							return b;
						}
						if(a==2)
						{
							return num[1]
						}
					})()</var>
				<var id="ANGLE_ONE">randRange(200, 240)</var>
				<var id="DIFF">(function(){
						if(a==1)
						{
							return 90;
						}
						if(a==2)
						{
							return randRange(60, 80);
						}
					})()</var>
				<var id="a1">(function(){
					if(DIFF==90)
					{
						return 4;
					}
					if(DIFF !== 90)
					{
						return 0;
					}
				})()</var>
				 <var id="FACTORS">[b, b, b1, b1]</var>
			</div>			
			<div class="question">
			<p>量量看，下面四邊形的每一邊有多長？它有幾個角是直角？</p>
				<div class="problem">
					<div class="graphie" id="figure">
						var ANGLE_TWO = ANGLE_ONE + DIFF;
						var ANGLE_ONE_R = ANGLE_ONE * PI / 180;
						var ANGLE_TWO_R = ANGLE_TWO * PI / 180;
					
						 init({
						range: [[-12,15], [-12, 12] ],
                        scale:19.1
							});
						path([ [b * cos( ANGLE_ONE_R ), b * sin( ANGLE_ONE_R )+4], [0, 4], [b1 * cos( ANGLE_TWO_R ), b1 * sin( ANGLE_TWO_R )+4] ,[(b1 * cos( ANGLE_TWO_R )+b * cos( ANGLE_ONE_R )), (b * sin( ANGLE_ONE_R )+b1 * sin( ANGLE_TWO_R ))+4],[b * cos( ANGLE_ONE_R ), b * sin( ANGLE_ONE_R )+4]]);					 
						addMouseLayer();						
						graph.triangleruler = new ruler( [3, -3] );
					</div>					
				</div>	
			</div>
			
		   <div class="solution" data-type="set">  
				
				<div class="set-sol" data-type="multiple"> 					
					<span class="sol"><var>b</var></span>          
					<span class="sol"><var>b</var></span>           
					<span class="sol"><var>b1</var></span>
					<span class="sol"><var>b1</var></span> 	
					<span class="sol"><var>a1</var></span>					
				</div>
				<div class="set-sol" data-type="multiple">       
					<span class="sol"><var>b1</var></span>
					<span class="sol"><var>b1</var></span> 
					<span class="sol"><var>b</var></span>          
					<span class="sol"><var>b</var></span> 
					<span class="sol"><var>a1</var></span>
				</div>
				<div class="set-sol" data-type="multiple">         
					<span class="sol"><var>b</var></span>          
					<span class="sol"><var>b1</var></span>           
					<span class="sol"><var>b</var></span>
					<span class="sol"><var>b1</var></span>
					<span class="sol"><var>a1</var></span>
				</div>
				<div class="set-sol" data-type="multiple">       
					<span class="sol"><var>b</var></span>
					<span class="sol"><var>b1</var></span> 
					<span class="sol"><var>b1</var></span>          
					<span class="sol"><var>b</var></span>
					<span class="sol"><var>a1</var></span>
				</div>
				<div class="set-sol" data-type="multiple">       
					<span class="sol"><var>b1</var></span>
					<span class="sol"><var>b</var></span> 
					<span class="sol"><var>b1</var></span>          
					<span class="sol"><var>b</var></span> 
					<span class="sol"><var>a1</var></span>
				</div>
				<div class="set-sol" data-type="multiple">       
					<span class="sol"><var>b1</var></span>
					<span class="sol"><var>b</var></span> 
					<span class="sol"><var>b</var></span>          
					<span class="sol"><var>b1</var></span> 
					<span class="sol"><var>a1</var></span>
				</div>
				<div class="input-format">
					<p class="entry" data-type="multiple">					
						邊長分別為：<br />
						<code>\enspace\enspace\enspace</code><span class="sol"></span>  公分<br />  
						<code>\enspace\enspace\enspace</code><span class="sol"></span>  公分<br />		   
						<code>\enspace\enspace\enspace</code><span class="sol"></span>  公分<br />
						<code>\enspace\enspace\enspace</code><span class="sol"></span>  公分 <br />
						有 <span class="sol"></span> 個直角
					</p>
				</div>
				<p class="example">整數，例 <code>：6</code></p>
			</div>
			<div class="hints">
				<p data-if="a==1">這個圖形邊長都是 <code><var>b</var></code> 公分，</p>
				<p data-if="a==1">4 個邊都一樣長，</p>
				<p data-if="a==1">這個圖形的四個角都是直角，</p>
				<p data-if="a==1">所以它是正方形</p>
				<p data-if="a==2 && DIFF==90">這個圖形邊長分別為： <code><var>b</var></code> 公分，<code><var>b</var></code> 公分，<code><var>b1</var></code> 公分，<code><var>b1</var></code> 公分，</p>
				<p data-if="a==2 && DIFF==90">這個圖形的四個角都是直角，</p>
				<p data-if="a==2 && DIFF==90">所以它是長方形</p>
				<p data-if="a==2 && DIFF !==90">這個圖形邊長分別為： <code><var>b</var></code> 公分，<code><var>b</var></code> 公分，<code><var>b1</var></code> 公分，<code><var>b1</var></code> 公分</p>
				<p data-if="a==2 && DIFF !==90">這個圖形的四個角都不是直角，且兩組對邊分别平行，</p>
				<p data-if="a==2 && DIFF !==90">所以它是平行四邊形</p>
			</div>
		</div>
		<div id="case2">
			<div class="vars">
				<var id="a">randFromArray([["長","ㄔ","ㄤˊ"],["正","ㄓ","ㄥˋ"]])</var>
				<var id="L"> 12</var>
				<var id="W"> 12</var>
				<var id="b">randRange(2,10)</var>
				<var id="c">(function()
					{
						if(a[0]=="長"){return 1;}
						if(a[0]=="正"){return 2;}
					})()</var>				
			</div>	
			 <div class="problem">
			 <p>完成下圖方格中的<var>a[0]</var>方形</p>
                <div class="graphie" id="barchart">
                    init({ range: [[-2, L + 1], [-1, W + 1]], scale: 25 });
						path([[0, 0], [0, W], [L, W], [L, 0], true],
							{stroke: GRAY, fill: "#eee"});
						label([1, 11.8], 1 + "\\text{ cm}", "above");
						line([1,11],[1, 11-b],{stroke:"#6495ED"});
						style({
								stroke: GRAY,
								strokeWidth: 1,
								strokeDasharray: "-"
							}, function() {
								_(L - 1).times(function(x) {
									path([[x + 61 / 60, 0], [x + 61 / 60, W]]);
								});
								_(W - 1).times(function(y) {
									path([[0, y + 61 / 60], [L, y + 61 / 60]]);
								});
							});
					
                    addMouseLayer();
					graph.leftPoints = addMovablePoint({ coord: [   1, 11 ], visible: false });
					graph.rightPoints = addMovablePoint({ coord: [  1, 11.01 ], visible: true ,snapX: 1, constraints: { constrainY: true }});
					graph.lines = addMovableLineSegment({ pointA: graph.leftPoints, pointZ: graph.rightPoints,  constraints: {  fixed:true} });
					
					graph.leftPoints1 = addMovablePoint({ coord: [   1, 11-b ], visible: false });
					graph.rightPoints1 = addMovablePoint({ coord: [  1, 11.01-b ], visible: true,snapX: 1, constraints: { constrainY: true } });
					graph.lines = addMovableLineSegment({ pointA: graph.leftPoints1, pointZ: graph.rightPoints1, snapX: 1, constraints: { fixed:true} });
					graph.lines = addMovableLineSegment({ pointA: graph.rightPoints, pointZ: graph.rightPoints1, snapX: 1, constraints: { fixed:true} });    
                </div>
			</div>
			<div class="solution" data-type="custom">
				<div class="guess">[graph.rightPoints.coord,graph.rightPoints1.coord]</div>
				<div class="validator-function">
					var bol1=false;
					if(c==2 && (guess[0][0]-1)==b && (guess[0][1]-guess[1][1])==b && (guess[1][0]-1)==b)
					{
							bol1=true;
					}
					if(c==1 && (guess[0][1]-guess[1][1])==b && (guess[0][0]==(guess[1][0])&& ((guess[0][0]-1)!==b) &&((guess[1][0]-1)!==b)))
					{
						bol1=true;
					}
					return bol1;
					</div>
				<p class="example">請移動題目中橙色的點繪出所需圖形</p>
            </div>   
			<div class="hints">
				<P data-if="c==1">長方形：四個角均需為直角，兩個對邊需平行且等長。</P>
				<P data-if="c==2">正方形：四個角均需為直角，四個邊需要平行且等長。</P>
				<p>橙色線條為提示。</p>				
				<p data-if="c==1" class="graphie" data-update="barchart">line([1,11],[b,11],{ stroke: ORANGE })</p>					
				<p data-if="c==2" class="graphie" data-update="barchart">line([1,11],[b+1,11],{ stroke: ORANGE })</p>			
				<p data-if="c==1" class="graphie" data-update="barchart">line([1,11-b],[b,11-b],{ stroke: ORANGE })</p>				
				<p data-if="c==2" class="graphie" data-update="barchart">line([1,11-b],[b+1,11-b],{ stroke: ORANGE })</p>				
				<p data-if="c==1" class="graphie" data-update="barchart">line([b,11],[b,11-b],{ stroke: ORANGE })</p>				
				<p data-if="c==2" class="graphie" data-update="barchart">line([b+1,11],[b+1,11-b],{ stroke: ORANGE })</p>				
			</div>
		</div>	
           
	</div>
	</div>
</body>
</html>
		