<!DOCTYPE html>
<html data-require="math expressions rational-expressions">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>有理式的加減 1.5</title>
    <script src="../khan-exercise.js"></script>
    <script type="text/javascript">
        function getRationalExpression(variables) {
            var terms = [];
            var shuffled = KhanUtil.shuffle(variables, KhanUtil.randRange(1, 2));

            for (var i = 0; i < shuffled.length; i++) {
                var n = i > 0 ? KhanUtil.randRangeNonZero(-6, 6) : KhanUtil.randRange(1, 6);
                terms.push([n, shuffled[i]]);
            }

            if (shuffled.length + KhanUtil.randRange(0, 1) < 2) {
                terms.push([KhanUtil.randRangeWeighted(-6, 6, 1, 0.5)]);
            }

            return new KhanUtil.RationalExpression(terms);
        };

        function getUsedVariables(expressions) {
            var usedVariables = [];

            for (var i = 0; i < expressions.length; i++) {
                for (var j = 0; j < expressions[i].terms.length; j++) {
                    for (var k in expressions[i].terms[j].variables) {
                        if (usedVariables.indexOf(k) === -1) {
                            usedVariables.push(k);
                        }
                    }
                }
            }

            usedVariables.sort();
            return usedVariables;
        }
		function addPlusChar(arr){
			for(var i = 0;i<arr.length;i++){
				if(arr[i].charAt(0)=="+"){
					arr[i]=arr[i].substr(1,arr.length);
				}
			}
			return arr;
		}
		function checkArr(arr1,arr2){
			if(arr1.length!=arr2.length){
				return false;
			}
			for(var i = 0;i<arr1.length;i++){
				if(arr1[i]!=arr2[i]){
					return false;
				}
			}
			return true;
		}
		function reverseStr(str){
			if(str.charAt(0)=='-'){
				return str.substr(1,str.length);
			}else return '-'+str;
		}
		function checkReverse(arr1,arr2){
			if(arr1.length!=arr2.length){
				return false;
			}
			var arrNew = arr2;
			for(var i = 0;i<arr1.length;i++){
				for(var j = 0;j<arrNew.length;j++){
					if(reverseStr(arr1[i])==arrNew[j]){
						arrNew.splice(j,1);
					}
				}
			}
			if(arrNew.length!=0){
				return false;
			}
			return true;
		}
    </script>
</head>
<body>
    <div class="exercise">
        <div class="vars" data-ensure="SUMNUMERATOR.toString() !== NUMERATOR1.toString() + ' + ' + NUMERATOR2.toString()">
            <var id="SIGN">randFromArray(["+", "-"])</var>
            <var id="X">randFromArray([
                ["a", "b", "c"],
                ["f", "g", "h"],
                ["m", "n", "p"],
                ["r", "s", "t"],
                ["p", "q", "r"],
                ["x", "y", "z"] ])
            </var>
            <var id="Y">"k"</var>
            <var id="FACTORCOEFFICIENT">randRange(0, 1) ? randFromArray([2, 5, 10]) : 1</var>
            <var id="FACTORTERM">randRange(0, 1) ? FACTORCOEFFICIENT: new Term(FACTORCOEFFICIENT, randFromArray(X))</var>
            <div data-ensure="DENOMINATOR.toString() !== '1'">
                <var id="DENOMINATOR">getRationalExpression(X).multiply(FACTORTERM)</var>
            </div>
            <div data-ensure="DENOMINATOR !== NUMERATOR1">
                <var id="NUMERATOR1">getRationalExpression(X).multiply(FACTORTERM)</var>
            </div>
            <div data-ensure="DENOMINATOR !== NUMERATOR2">
                <var id="NUMERATOR2">getRationalExpression(X).multiply(FACTORTERM)</var>
            </div>
            <var id="USEDVARIABLES">getUsedVariables([DENOMINATOR, NUMERATOR1, NUMERATOR2])</var>
            <var id="SIGNEDNUMERATOR">SIGN === "+" ? NUMERATOR2 : NUMERATOR2.multiply(-1)</var>
            <var id="SUMNUMERATOR">NUMERATOR1.add(SIGNEDNUMERATOR)</var>
            <var id="GCD">SUMNUMERATOR.getGCD(DENOMINATOR)</var>
            <var id="SOLNUMERATOR">SUMNUMERATOR.divide(GCD)</var>
            <var id="SOLDENOMINATOR">DENOMINATOR.divide(GCD)</var>
        </div>

        <div class="problems">
            <div id="add">
                <p class="problem">化簡並展開下式 <code>:</code></p>
                <p class="question">
                    <code><var>Y</var> = \dfrac{<var>NUMERATOR1</var>}{<var>DENOMINATOR</var>}
                          <var>SIGN</var> \dfrac{<var>NUMERATOR2</var>}{<var>DENOMINATOR</var>}</code>
                </p>
                <p>假設 <code><var>USEDVARIABLES</var> \neq 0</code>.</p>

                <div class="solution" data-type="multiple">
					<table>
						<tr><td style="border-bottom:1px solid black"><input type="text" style="width:100px;text-align:center;" id="a1"></td></tr>
						<tr><td style="border-top:1px solid black"><input type="text" style="width:100px;text-align:center" id="a2"></td></tr>
					</table>
					<div class="sol" data-type="custom">
						<div class="guess">[$('#a1').val().toString().replace(/[ ]/g,"").replace(/−/g,'-'),$('#a2').val().toString().replace(/[ ]/g,"").replace(/−/g,'-'),GCD.toString() !== '1'?SOLNUMERATOR.toString().replace(/[ ]/g,"").replace(/−/g,'-'):SUMNUMERATOR.toString().replace(/[ ]/g,"").replace(/−/g,'-'),GCD.toString() !== '1'?SOLDENOMINATOR.toString().replace(/[ ]/g,"").replace(/−/g,'-'):DENOMINATOR.toString().replace(/[ ]/g,"").replace(/−/g,'-')]</div>
						<div class="validator-function">
							if(guess[0]==""||guess[1]==""){
								return "";
							}
							var ansArr = new Array();
							var ansArrBelow = new Array();
							var ver1 = new Array();
							var ver2 = new Array();
							var ind1 = 0;
							var ind2 = 0;
							var ind3 = 0;
							var ind4 = 0;
							for(var i=1;i&lt;guess[0].length;i++){
								if(guess[0].charAt(i)=="+"||guess[0].charAt(i)=="-"){
									ansArr[ind1] = guess[0].substr(0,i);
									ind1++;
									guess[0] = guess[0].substr(i,guess[0].length);
									i=1;
								}
							}
							for(var i=1;i&lt;guess[1].length;i++){
								if(guess[1].charAt(i)=="+"||guess[1].charAt(i)=="-"){
									ansArrBelow[ind2] = guess[1].substr(0,i);
									ind2++;
									guess[1] = guess[1].substr(i,guess[1].length);
									i=1;
								}
							}
							for(var i=1;i&lt;guess[2].length;i++){
								if(guess[2].charAt(i)=="+"||guess[2].charAt(i)=="-"){
									ver1[ind3] = guess[2].substr(0,i);
									ind3++;
									guess[2] = guess[2].substr(i,guess[2].length);
									i=1;
								}
							}
							for(var i=1;i&lt;guess[3].length;i++){
								if(guess[3].charAt(i)=="+"||guess[3].charAt(i)=="-"){
									ver2[ind4] = guess[3].substr(0,i);
									ind4++;
									guess[3] = guess[3].substr(i,guess[3].length);
									i=1;
								}
							}
							ansArr.push(guess[0]);
							ansArr.sort();
							addPlusChar(ansArr);
							ansArrBelow.push(guess[1]);
							ansArrBelow.sort();
							addPlusChar(ansArrBelow);
							ver1.push(guess[2]);
							ver1.sort();
							addPlusChar(ver1);
							ver2.push(guess[3]);
							ver2.sort();
							addPlusChar(ver2);
							return (checkArr(ansArr,ver1)&&checkArr(ansArrBelow,ver2))||(checkReverse(ansArr,ver1)&&checkReverse(ansArrBelow,ver2));
						</div>
					</div>
					<p class="example">分別填入分子與分母</p>
					<p class="example">分子與分母的式子要最簡</p>
					<p class="example"><code>x*3</code> 要寫成 <code>3x</code></p>
					<p class="example"><code>y^{2}</code> 寫成 <code>y</code>^<code>2</code></p>
                </div>
            </div>

        </div>

        <div class="hints">
            <div data-if="SIGN === '+'">
                <p>由於該式有相同的分母，所以我們可以簡單的合併分子 <code>:</code></p>
                <p><code><var>Y</var> = \dfrac{<var>NUMERATOR1</var> + <var>NUMERATOR2</var>}{<var>DENOMINATOR</var>}</code></p>
            </div>
            <div data-else="">
                <p>由於該式有相同的分母，所以我們可以簡單的合併分子 <code>:</code></p>
                <p><code><var>Y</var> = \dfrac{<var>NUMERATOR1</var> - (<var>NUMERATOR2</var>)}{<var>DENOMINATOR</var>}</code></p>
            </div>

            <div>
                <p><code><var>Y</var> = \dfrac{<var>SUMNUMERATOR</var>}{<var>DENOMINATOR</var>}</code></p>
            </div>

            <div data-if="GCD.toString() !== '1'">
                <p>分子和分母有一個共同的因子 <code><var>GCD.toString()</var></code>， 所以我們可以將式子化簡為 <code>:</code></p>
                <p><code><var>Y</var> = \dfrac{<var>SOLNUMERATOR</var>}{<var>SOLDENOMINATOR</var>}</code></p>
            </div>
        </div>
    </div>
</body>
</html>
